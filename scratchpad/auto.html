<!DOCTYPE html>
<!--
Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or http://ckeditor.com/license
-->
<html>
<head>
	<meta charset="utf-8">
	<title>XHTML Compliant Output &mdash; CKEditor Sample</title>
	<meta name="ckeditor-sample-required-plugins" content="sourcearea">
	<script src="https://code.jquery.com/jquery-1.11.2.min.js">


	</script>
	<script src="scripts/entities.store.js"></script>
	<script src="scripts/entities.selection.js"></script>
	<script src="scripts/entities.paste.js"></script>
	<script src="scripts/entities.conditional.collapser.js"></script>
	<script src="scripts/entities.markupmanager.js"></script>
	<script src="scripts/autosuggest.container.js"></script>
	<script src="scripts/sentencetokenizer.js"></script>
	<script src="scripts/tokentokenizer.js"></script>
	<link href="../vendor/ckeditor/samples/sample.css" rel="stylesheet">
	<link href="css/autosuggest.css" rel="stylesheet">
	<link href="css/collapse.css" rel="stylesheet">
</head>
<body>
	<h1>
		Scratch pad for auto completes
	</h1>
			<style>
				span.rules {
					display: inline-block;
					color: rgba(0,0,0,0);
					width: 0;
					overflow: hidden;
				}

			</style>

	
	
		<script>


		
		$(function () {
			var editPanel = document.getElementById("edit")
			editPanel.addEventListener("focusin", function () {
				//this.className = 'editing'
			});
			editPanel.addEventListener("focusout", function () {
				//this.className = ''
			});


			var translationContainer = new AutoSuggestContainer("translation-menu",new SentenceTokenizer());
			var tokenContainer = new AutoSuggestContainer("token-menu",new TokenTokenizer())
			tokenContainer.getLastSentenceFromRange = function (range) {
				var token =  range.toString().match(/(?:\s*)(<)[^>]*$/);
				if (token) {
					return token[1]
				}
				return null;
			}
			var translationStore = new TranslationStore();
			var tokenStore = new TokenStore();
			var conditionalCollapser = new ConditionalCollapser()
			

			$.ajax("xml/keys.json", {mimeType:"application-x/json", success: function (keys) {
				for (var i=0;i<keys.length;i++) {
					translationStore.addEntity(keys[i].def,"key"+i)
				}
				translationContainer.build(translationStore);
				
				translationContainer.setEditableElement(document.getElementById("edit"));

				var entitiesSelection = new EntitySelectionManager()
				entitiesSelection.init(document.getElementById("edit"))
				//var pasteManager = new EntityPasteManager()
				//pasteManager.init(document.getElementById("edit"))
				conditionalCollapser.init(document.getElementById("edit"))
				//var markupmanager = new EntityMarkupManager()
				//markupmanager.init(document.getElementById("edit"))
				

				/*input.oninput = function () {
					autoSuggestContainer.handleValue(this.value)
				}
				input.onchange = function () {
					//autoSuggestContainer.hide()
				}*/
			}})

			$.ajax("xml/tokens.json", {

	mimeType:"application-x/json",
	success: function (tokens) {
		console.log("success")
			for (var i=0;i<tokens.length;i++) {
				tokenStore.addEntity("<"+tokens[i].text+">",tokens[i].id,tokens[i].preview)
			}

				tokenContainer.build(tokenStore)
				tokenContainer.setEditableElement(document.getElementById("edit"))
	}
})
			})

				
				
			//}})

		//})
		</script>
		<div id="edit" contenteditable="true" class="editing">
			Type in here
		</div>
</body>
</html>
