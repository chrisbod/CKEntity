<!DOCTYPE html>
<!--
Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or http://ckeditor.com/license
-->
<html>
<head>
	<meta charset="utf-8">
	<title>XHTML Compliant Output &mdash; CKEditor Sample</title>
	<meta name="ckeditor-sample-required-plugins" content="sourcearea">
	<script src="../vendor/jquery/jquery-1.11.2.min.js">

 
	</script>
	<meta name="ckeditor-sample-required-plugins" content="sourcearea">
	<script src="../vendor/ckeditor/ckeditor.js"></script>
	<script src="../vendor/ckeditor/plugins/wallstreetdocs/plugin.js"></script>
	<script src="scripts/selectcontrol.js"></script>
	<script src="scripts/entities.js"></script>
	<script src="scripts/entities.store.js"></script>
	<script src="scripts/entities.languagestore.js"></script>
	<script src="scripts/selectiontracker.js"></script>
	<script src="scripts/entities.paste.js"></script>
	<script src="scripts/entities.conditional.collapser.js"></script>
	<script src="scripts/entities.markupmanager.js"></script>
	<script src="scripts/entities.usergenerated.js"></script>
	<script src="scripts/entities.edit.knockout.viewmodels.js"></script>
	<script src="scripts/documenttranslator.js"></script>
	<script src="scripts/intent.js"></script>
	<script src="scripts/positionablecontainer.js"></script>
	<script src="scripts/autosuggest.container.js"></script>
	<script src="scripts/entities.tooltip.js"></script>
	<script src="scripts/sentencetokenizer.js"></script>
	<script src="scripts/tokentokenizer.js"></script>
	<script src="scripts/headerandfooterhandler.js"></script>
	<script src="scripts/radiodeselect.js"></script>
	<script src="scripts/templates.js"></script>
	<script src="../vendor/knockout/knockout-3.3.0.js"></script>
	<link href="css/autosuggest.css" rel="stylesheet">
	<link href="css/dialog-form.css" rel="stylesheet">
	<link href="css/tooltip.css" rel="stylesheet">
	<link href="css/kid.css" rel="stylesheet">
</head>
<body>
			<style>
			body {
				font-family: Arial, Helvetica, sans-serif;
			}
				span.rules {
					display: inline-block;
					color: rgba(0,0,0,0);
					width: 0;
					overflow: hidden;
				}

			

			</style>

	
	
		<script>


		//window.addEventListener("contextmenu", function (e){event.stopPropagation()},true)
		
	var translationContainer = new AutoSuggestContainer("translation-menu");
	var tokenContainer = new AutoSuggestContainer("token-menu");
	tokenContainer.getLastSentenceFromRange = function (range) {
		var token =  range.toString().match(/(?:\s*)(<)[^>]*$/);
		if (token) {
			return token[1]
		}
		return null;
	}
	var languageStore = new LanguageStore("json/tokens","json/logic","json/translations");
	EntitiesHelper.prototype.languageStore = languageStore;//NASTY....
	var conditionalCollapser = ConditionalCollapser.getInstance()
	var entityTooltip = new EntityTooltip()
	var userConditionalManager = new UserConditionalManager();
	var pasteManager = new EntityPasteManager()

	//var markupManager = new EntityMarkupManager()
	var entitiesSelection = SelectionTracker.getInstance()

	var translator = new DocumentTranslator(languageStore)
	var headersAndFooters = new HeaderAndFooterHandler();
	var templateService = TemplateService.getInstance("https://www.firelex.com/priip/api/template/")


function build(editor,editPanel,language)  {
	//allow context menu when appropriate

	editPanel.addEventListener("contextmenu", function (event) {
		event.stopPropagation()
	},true);
	

	function updateAutosuggests(lang) {
		translationContainer.build(languageStore.getTranslationStoreByLanguage(lang),languageStore.getSentenceTokenizerByLanguage(lang))
		tokenContainer.build(languageStore.getTokenStoreByLanguage(lang),languageStore.getTokenTokenizerByLanguage(lang))

	}
	languageStore.installLanguage(language, function (languageDefinition) {
		if (language != languageStore.currentLanguage) {
			translator.translate(editPanel,languageDefinition.id)
			languageStore.setCurrentLanguage(languageDefinition.id);
			updateAutosuggests(languageDefinition.id)
		}
		
		
	});


	entityTooltip.init(editPanel,document.querySelector("#entity-edit"));
	userConditionalManager.init(editPanel)
	conditionalCollapser.init(editPanel)
	//markupManager.init(editPanel)
	pasteManager.init(editPanel)
	entitiesSelection.init(editPanel)
	translationContainer.setEditableElement(editPanel);
	tokenContainer.setEditableElement(editPanel);
	headersAndFooters.init(editPanel)
	//new RadioDeselect().init(document)



}
$(function () {



	CKEDITOR.replace( 'documentSource', {
				title: false,
				disableNativeSpellChecker: false,
				allowedContent: true,
				fullPage: true,
				allowedContent: true,
				extraPlugins: 'tab,wysiwygarea,wallstreetdocs,wordpaste,documentlang,knockoutdialog,pagebreaktag,wsdpreview,wsdtoolbar',
				removePlugins: 'elementspath,magicline,pastetext,pastefromword,clipboard,forms,scayt',
				language_list: [ 'en:English', 'fr:French', 'de:German'],
				removeButtons: 'Source,Preview,Print,Save,NewPage,DocProps,Templates,SpellChecker,CreateDiv,Flash,Smiley,PageBreak,Iframe,Format,About,Language,SpellChecker',
				skin: 'flat',
				on :
   {
      // Maximize the editor on start-up.
      'instanceReady' : function( evt )
      {
         evt.editor.execCommand( 'maximize' );
         $.ajax('templates/empty.html', {
				success: function (data) {
					evt.editor.setReadOnly(true);
					evt.editor.setData(data, setTimeout.bind(null,function () {
						evt.editor.setReadOnly(false)
						
						evt.editor.execCommand('wsdopen',{
							buttonsToHide: ['ok','cancel'],
							removeOpacity: true,
							disableClose: true,
							expandToFit: true
						})
					},100))



				}
			})



      }
   } 

			});
			

			


	
	


});


		</script>
		
		<form action="javascript:;" method="GET">

		<textarea id="documentSource" style="width: 100%; height: 100ex">


		</textarea>
	</form>



		<div class="dialog paper-layout token" data-bind="ckeditorDialog: active" id="tokenDialog">
		
		<form id="test" data-bind="submit: update">
			
			
				
				
				
			<section>
				<ul data-bind="foreach: groups">
					<li>
						<div data-bind="text: label"></div>
						<!--tried using a switch here but had scoping issues-->
						<div data-bind="foreach: controls">
							<!--ko if: type == 'checkbox' -->
							
								<label class="clear">
									<input type="checkbox" data-bind="value:value, attr:{name:value}, checked: $root.values()[value]">
									<span data-bind="text:text"></span>
								</label>
							
							<!--/ko-->
							<!--ko if: type == 'radio' -->
							<label class="clear">
								<input type="radio" data-bind="attr:{name: $parent.id}" value=""/>
								<span>clear</span>
							</label>
								
									<!--ko foreach: options -->
											<label>
												<input type="radio" data-bind="value:value, name:$parent.id, checked: $root.values()[$parent.id] == value">
												<span data-bind="text:text"></span>
												
											</label>
										<!--/ko-->
							
							<!--/ko-->
							<!--ko if: type == 'select' -->
							
								<select data-bind="minimumSelected: 0, attr:{name:id }, options: options, optionsText: 'text', 	optionsValue: 'value', value: $root.values()[id], onclick: $root.checkSelect()">
								</select>
							
							<!--/ko-->
							<!--ko if: type == 'text' -->
							
								<label>
									<div data-bind="text: (typeof label != 'undefined' ?  label : '')"></div>
								<input type="text" data-bind="attr:{name:id, placeholder: (typeof placeholder != 'undefined' ?  placeholder : '')}, value: value "/>
								</label>
							
							<!--/ko-->
							<!--ko if: type == 'textarea' -->
							
								<label>
									<div data-bind="text: (typeof label != 'undefined' ?  label : '')"></div>
								<textarea data-bind="attr:{name:id,placeholder:(typeof placeholder != 'undefined' ?  placeholder : '')}, value: value"></textarea>
								</label>
							
							<!--/ko-->
						</div>
					</li>
				</ul>     
			</section>
			</form>
		</div>
		<div class="dialog paper-layout"  data-bind="ckeditorDialog: active" id="logicDialog">
			
		<form id="rules" data-bind="submit: newNameEnt">
			
			<section>
			<fieldset class="container-content">
				
					<ul data-bind="foreach: logic">
						
						<li>
						<div data-bind="text:text"></div>
						
						<div class="radio">
						<label class="clear">
							<input type="radio" data-bind="attr:{name: id}" value=""/>
							<span>clear</span>
						</label>	
							<!--ko foreach:items-->
						<label>
							<input type="radio" data-bind="attr:{name: $parent.id}, value: value, checked:$root.values()[$parent.id]" data-deselectable/>
							<span data-bind="text: text"></span>
						</label>
							<!--/ko-->
						
						</div>
						
					</li>

					
					</ul>
				</fieldset>
			</section>
			
			</form>
		</div>

		<div class="tooltip hidden"   data-bind="attr: {'class': 'tooltip' + (active() ? ' active' : ' hidden')}" id="entity-edit">
			

				<header data-bind="text:title()">
					
				</header>
				<fieldset>
					<!--ko if: canEditRules -->
					<button data-bind="click: launchRulesDialog">Rules</button>
					<!--/ko-->
					<!--ko if: canEditProperties-->
					<button data-bind="click: launchPropertiesDialog">Properties</button>
					<!--/ko-->
				</fieldset>
			
		</div>


		<div class="dialog logicDialog"  data-bind="ckeditorDialog: active" id="previewDialog">
			
		<form id="rules" data-bind="submit: update">
			
			<section>
			<fieldset class="container-content">
				
					<ul data-bind="foreach: logic">
						<li>
							<strong data-bind="text:text"></strong>
							<select size="4" data-bind="minimumSelected: 0,attr:{name:id }, options: items , optionsText: 'text', 	optionsValue: 'value', value: $root.values()[id]">
							</select>
						</li>
					</ul>
				</fieldset>
			</section>
			
			</form>
		</div>
<style>


</style>
		<div  class="paper-layout" id="templateList"  data-bind="ckeditorDialog: active">
			
			<form onsubmit="return false">
				<div class="form-container">
			<div class="columns">
					<section>
							<button data-bind="click:createNewTemplate">Create New</button>
							<button data-bind="click:deleteTemplate">Delete</button>
							<button data-bind="click:loadTemplate">Load Selected</button>		
					</section>
					
					<section class="template-list">
						<section class="templates-wrapper" data-bind="event:{dblclick:loadTemplate}">
							<!--ko foreach: templates()-->
										<label class="template-name">
												<input type="radio" data-bind="checkedValue: $data,checked: $parent.selected" name="templateId">
												<span data-bind="text: $data.templateName"></span>
												
										</label>
							<!--/ko-->
						</section>
					</section>
					
					
			
			

			</div>
			
			<!--ko if: creating() == true -->
					<section class="creating-new">
						<input type="text" value="" placeholder="Enter new name" required="true" data-bind="event:{keypress:nameInput}, hasFocus:creating() == true, textInput:templateName">
						<button data-bind="event: {click:templateCreateButton}">Create</button>

					</section>
					<!--/ko-->
			<!--ko if: errorMessage() != '' -->
			<section class="error">
				<p data-bind="text:errorMessage"></p>
				<pre data-bind="text:errorDetails"></pre>
				<button class="ok-button" data-bind="click: clearError">Ok</button>
			</section>
			<!--/ko-->
		</div>
			</form>	



	</div>
		
					
</body>
</html>
